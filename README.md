# Bookmark Manager - Local Development Setup

[![CI](https://github.com/OWNER/REPO/actions/workflows/ci.yml/badge.svg)](https://github.com/OWNER/REPO/actions/workflows/ci.yml)

<!-- Replace OWNER/REPO above with your GitHub org/user and repository slug. -->

## Tech Stack Overview

This comprehensive bookmark manager application is built with modern full-stack technologies. Here's everything you need to set up the project locally.

## Prerequisites

### Required Software

- **Node.js**: Version 18+ (LTS recommended)
- **npm**: Version 8+ (comes with Node.js)
- **PostgreSQL**: Version 14+ or access to a PostgreSQL database
- **Git**: For version control

### System Requirements

- Operating System: Windows, macOS, or Linux
- RAM: 4GB minimum, 8GB recommended
- Storage: 2GB free space for dependencies

## Frontend Stack

### Core Framework

- **React 18.3.1**: Modern React with hooks and concurrent features
- **TypeScript 5.6.3**: Full type safety across the application
- **Vite 5.4.19**: Fast build tool and development server

### UI & Styling

- **Tailwind CSS 3.4.17**: Utility-first CSS framework
- **shadcn/ui**: Component library built on Radix UI primitives
- **Radix UI**: Headless, accessible UI components
- **Lucide React**: Modern icon library
- **Framer Motion**: Animation library for smooth interactions

### State Management & Data Fetching

- **TanStack Query 5.60.5**: Server state management with caching
- **Wouter 3.3.5**: Lightweight client-side routing
- **React Hook Form 7.55.0**: Performant form handling
- **Zod 3.24.2**: TypeScript-first schema validation

### Additional Frontend Dependencies

```json
{
  "@hookform/resolvers": "^3.10.0",
  "class-variance-authority": "^0.7.1",
  "clsx": "^2.1.1",
  "date-fns": "^3.6.0",
  "react-markdown": "^10.1.0",
  "next-themes": "^0.4.6"
}
```

## Backend Stack

### Core Framework

- **Express.js 4.21.2**: Fast, minimalist web framework
- **TypeScript**: Full backend type safety
- **tsx 4.19.1**: TypeScript execution for development

### Database & ORM

- **PostgreSQL**: Primary database (local or cloud)
- **Drizzle ORM 0.39.1**: Type-safe SQL ORM
- **Drizzle Kit 0.30.4**: Database migrations and schema management
- **@neondatabase/serverless**: Neon database adapter (optional)

### Authentication & Security

- **Passport.js 0.7.0**: Authentication middleware
- **passport-local 1.0.0**: Local authentication strategy
- **bcrypt 6.0.0**: Password hashing
- **express-session 1.18.1**: Session management
- **express-rate-limit**: API rate limiting

### Additional Backend Dependencies

```json
{
  "connect-pg-simple": "^10.0.0",
  "memorystore": "^1.6.7",
  "nanoid": "^5.1.5",
  "ws": "^8.18.0",
  "zod-validation-error": "^3.4.0"
}
```

## Development Tools

### Build & Bundling

- **Vite**: Frontend build tool with HMR
- **esbuild 0.25.0**: Fast JavaScript bundler for production
- **PostCSS 8.4.47**: CSS processing
- **Autoprefixer**: Automatic vendor prefixing

### Code Quality

- **TypeScript**: Static type checking
- **ESLint**: Code linting (configured)
- **Prettier**: Code formatting (configured)

### Database Tools

- **Drizzle Kit**: Schema management and migrations
- **Drizzle Studio**: Database GUI (optional)

## Installation Instructions

### 1. Clone Repository

```bash
git clone <repository-url>
cd bookmark-manager
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Environment Setup

Create a `.env` file in the root directory:

```env
# Database Configuration
DATABASE_URL="postgresql://username:password@localhost:5432/bookmark_manager"

# Session Configuration
SESSION_SECRET="your-secure-session-secret-here"

# Development Settings
NODE_ENV=development
```

### 4. Database Setup

#### Option A: Local PostgreSQL

1. Install PostgreSQL locally
2. Create a database: `createdb bookmark_manager`
3. Update `DATABASE_URL` in `.env`

#### Option B: Cloud Database (Neon/Supabase)

1. Create a PostgreSQL instance on Neon, Supabase, or similar
2. Copy connection string to `DATABASE_URL`

### 5. Database Schema

```bash
# Push schema to database
npm run db:push
```

### 6. Start Development Server

```bash
# Start both frontend and backend
npm run dev
```

The application will be available at `http://localhost:4001`

## Chrome Extension (optional)

An optional Chrome extension is provided in `extension/` to save the current tab to your Memorize server.

- API endpoints for extensions:
  - `POST /api/ext/login` with `{ username, password }` → `{ token }`
  - `POST /api/ext/bookmarks` with `Authorization: Bearer <token>` and JSON body `{ url, name, description?, tags (array or comma string), isFavorite?, passcode?, autoGenerateTags?, autoGenerateDescription? }`
- Run `npm run db:push` to create the `api_tokens` table used for extension auth tokens.
- Load the extension: open `chrome://extensions`, enable Developer mode, click "Load unpacked" and select the `extension/` folder.
- Configure Server URL (defaults to `http://localhost:4001`), sign in once, and use the Create form.

## Project Structure

```
bookmark-manager/
├── client/                 # Frontend React application
│   ├── src/
│   │   ├── components/     # Reusable UI components
│   │   ├── pages/          # Route components
│   │   ├── lib/            # Utilities and configurations
│   │   └── hooks/          # Custom React hooks
│   └── index.html
├── server/                 # Backend Express application
│   ├── index.ts           # Server entry point
│   ├── routes.ts          # API routes
│   └── storage.ts         # Database operations
├── shared/                 # Shared types and schemas
│   └── schema.ts          # Drizzle database schema
├── migrations/            # Database migrations
├── vite.config.ts         # Vite configuration
├── tailwind.config.ts     # Tailwind CSS configuration
├── drizzle.config.ts      # Drizzle ORM configuration
└── package.json           # Dependencies and scripts
```

## Available Scripts

```bash
# Development
npm run dev          # Start development server

# Building
npm run build        # Build for production
npm run start        # Start production server

# Database
npm run db:push      # Push schema changes to database

# Type Checking
npm run check        # Run TypeScript type checking
```

## Configuration Files

### vite.config.ts

- React plugin configuration
- Path aliases (@, @shared, @assets)
- Development server settings
- Build output configuration

### tailwind.config.ts

- Custom color palette with CSS variables
- Dark mode configuration
- Component variants and animations
- Typography and spacing customization

### drizzle.config.ts

- Database connection configuration
- Schema file location
- Migration output directory
- PostgreSQL dialect settings

## Key Features Implemented

### Core Functionality

- ✅ User authentication with sessions
- ✅ Bookmark CRUD operations
- ✅ Hierarchical categories
- ✅ Tag-based organization
- ✅ Search and filtering
- ✅ Favorites system

### Advanced Features

- ✅ Bulk operations (select, delete, move)
 - ✅ AI-powered auto-tagging
 - ✅ AI-powered auto-description
- ✅ Automatic screenshot thumbnails
- ✅ Broken link monitoring
- ✅ Protected bookmarks with passcode
- ✅ Public bookmark sharing
- ✅ Mobile-responsive design
- ✅ Dark/light theme support
 - ✅ Settings page with preferences (theme, layout, default category, session timeout, per‑user link checker, export/import, auto‑tag toggle)
 - ✅ Hidden folder for protected bookmarks
 - ✅ Slug‑only category URLs

### Security Features

- ✅ Passcode protection for sensitive bookmarks
- ✅ Rate limiting on API endpoints
- ✅ SSRF protection for external requests
- ✅ Session-based authentication
- ✅ Input validation with Zod schemas

## Development Notes

### Path Aliases

- `@/` → `client/src/`
- `@shared/` → `shared/`
- `@assets/` → `attached_assets/`

### Database Migrations

- Use `npm run db:push` to apply schema changes
- Drizzle Kit manages migrations from `shared/schema.ts`
- Session table is included in the schema to prevent accidental drops during pushes
 - Preferences fields include: `defaultCategoryId`, `sessionTimeoutMinutes`, `linkCheckEnabled`, `linkCheckIntervalMinutes`, `linkCheckBatchSize`, `autoTagSuggestionsEnabled`, `aiTaggingEnabled`, `autoDescriptionEnabled`, `aiDescriptionEnabled`

### Environment Variables

- `DATABASE_URL`: PostgreSQL connection string
- `SESSION_SECRET`: Secret for session encryption
- `NODE_ENV`: Development/production mode
- `DB_SCHEMA` (optional): Schema name for session store (defaults to `public`)
- `THUMIO_TOKEN` (optional): Thum.io auth token for screenshot capture. If not set, the app uses unauthenticated Thum.io requests and may fall back to a placeholder.
- `THUMIO_WIDTH` (optional): Output image width used for Thum.io screenshots. Default `800`.
- `THUMIO_VP_WIDTH` (optional): Page viewport width for Thum.io rendering. Default `1024`.
- `THUMIO_VP_HEIGHT` (optional): Page viewport height for Thum.io rendering. Default `640`.
- `THUMIO_TIMEOUT_MS` (optional): Timeout for Thum.io probes in milliseconds. Default `8000`.
- `SCREENSHOT_PENDING_TIMEOUT_MS` (optional): Failsafe timeout to auto-fail screenshots stuck in pending. Default `30000`.
- `VITE_PUBLIC_BASE_URL` (optional): Absolute base URL for the site (e.g., `https://yourdomain.com`). Used for canonical URLs and structured data in the SEO helper.
 - `OPENAI_API_KEY` (optional): Enables AI-assisted features. Server uses moderation via `omni-moderation-latest`. If OpenRouter is not configured, OpenAI is used for chat generation.
 - `OPENAI_TAG_MODEL` (optional): OpenAI model for tag generation. Default `gpt-5-nano` in code unless overridden.
 - `OPENAI_DESC_MODEL` (optional): OpenAI model for description generation. Defaults to `OPENAI_TAG_MODEL` or `gpt-5-nano`.
 - `OPENAI_TAGS_MAX` (optional): Max number of tags to return. Default `8`.
 - `OPENAI_TIMEOUT_MS` (optional): Timeout for AI requests in milliseconds. Default `6000`.
 - `OPENROUTER_API_KEY` (optional): When set, uses OpenRouter for chat completions.
 - `OPENROUTER_TAG_MODEL` (optional): OpenRouter model for tag generation. Default `deepseek/deepseek-chat-v3.1:free`.
 - `OPENROUTER_DESC_MODEL` (optional): OpenRouter model for description generation. Default `deepseek/deepseek-chat-v3.1:free`.
 - `AI_DESC_MAX_CHARS` (optional): Max characters for generated descriptions (120–500). Default `300`.
 - `AI_DESC_MIN_CHARS` (optional): Minimum target length; if first draft is shorter, the server retries once to expand. Default `180`.

### Hot Module Replacement

- Frontend: Automatic with Vite
- Backend: Automatic with tsx watch mode
- Database: Manual push required for schema changes

## Troubleshooting

### Common Issues

1. **Database Connection**: Verify `DATABASE_URL` format and credentials
2. **Port Conflicts**: Application uses port 4001 by default
3. **Node Version**: Ensure Node.js 18+ is installed
4. **Dependencies**: Clear `node_modules` and reinstall if needed

### Performance Tips

- Use lazy loading for large bookmark collections
- Enable database indexing for search queries
- Optimize images and screenshots for faster loading
- Consider connection pooling for production

### Screenshots

- Thum.io is used to generate thumbnails. When `THUMIO_TOKEN` is set, authenticated PNG requests are used: `https://image.thum.io/get/auth/<token>/png/<options>/<url>`.
- If no token is configured, unauthenticated PNG requests are attempted; if they fail, a placeholder is applied.
- If you encounter 400 responses from Thum.io, verify the token value and try simplifying options. The server already retries with both a full and a minimal option set.
 - Defaults favor smaller images for faster loading: width `800`, viewport `1024x640`. Override with `THUMIO_WIDTH`, `THUMIO_VP_WIDTH`, `THUMIO_VP_HEIGHT`.

## Feature Details

### SEO

- Base meta tags are defined in `client/index.html` (title, description, Open Graph, Twitter).
- Dynamic meta on SPA routes is handled by `SEO` helper in `client/src/lib/seo.tsx`.
- Robots and sitemap are provided in `client/public/robots.txt` and `client/public/sitemap.xml`.
- Set `VITE_PUBLIC_BASE_URL` in production to generate canonical URLs and JSON‑LD structured data.

### Settings & Preferences

- Theme: light/dark toggle (persists)
- Layout: list/grid segmented control (persists)
- Default Category: used when creating new bookmarks
- Session Timeout: 1 minute minimum; rolling sessions extend on activity
- Link Check Schedule (per user): enable/disable, interval (min 1 minute), batch size; “Run now” for a one‑off check
- Export/Import: JSON/CSV export; CSV import with column mapping and tags delimiter
- Auto‑tag Suggestions: enable/disable automatic tag suggestions when adding bookmarks
  - When `OPENAI_API_KEY` is configured, AI is used to refine tags; otherwise, a heuristic fallback is used.
 - Auto‑description: when description is blank, the server will attempt to generate a concise description in the background (OpenRouter preferred when `OPENROUTER_API_KEY` is set; otherwise OpenAI if available). Preview and per‑bookmark endpoints are also available.

### API Endpoints (AI)

- POST `/api/bookmarks/preview-auto-tags`
  - Body: `{ url: string; name?: string; description?: string }`
  - Response: `{ suggestedTags: string[] }`

- POST `/api/bookmarks/:id/auto-tags`
  - Body: `{ passcode?: string }`
  - Response: `{ suggestedTags: string[] }`

- POST `/api/bookmarks/preview-auto-description`
  - Body: `{ url: string; name?: string; description?: string }`
  - Response: `{ suggestedDescription: string | undefined }`

- POST `/api/bookmarks/:id/auto-description`
  - Body: `{ passcode?: string; overwrite?: boolean }`
  - Response: `{ description: string | null | undefined; generated: boolean; updated: boolean }`

Behavior
- On create/update, if a bookmark’s description is blank, the server triggers background generation and updates the record when ready. This avoids blocking the request.
- Support: contact email `nt.apple.it@gmail.com`

### Categories & Routing

- Slug‑only category URLs: `/category/<slug-hash>`
- Hidden folder lists protected bookmarks across categories
- Uncategorized lists bookmarks without a category
- All Bookmarks hides protected items; sidebar badge shows visible count (total − protected)

### Export/Import Notes

- CSV export columns: `name, url, description, tags, isFavorite, category`
- CSV import mapping supports fields above; tags delimiter default `|`; accepted favorites: `1/true/yes/y`
- Optional target category can be applied to all imported rows

---

This README documents setup, features, and workflows for efficient local development and testing.
